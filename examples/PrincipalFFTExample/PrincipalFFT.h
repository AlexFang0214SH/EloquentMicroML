void principalFFT(float *features, float *fft) {
    // apply principal FFT (naive implementation for the top N frequencies only)
    const int topFrequencies[] = { 0, 8, 17, 16, 1, 9, 2, 7, 15, 6 };
    const float cosLUT[10][64] = {
        {  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0},
        {  1.0,  0.7071067811865476,  6.123233995736766e-17,  -0.7071067811865475,  -1.0,  -0.7071067811865477,  -1.8369701987210297e-16,  0.7071067811865474,  1.0,  0.7071067811865477,  3.061616997868383e-16,  -0.7071067811865467,  -1.0,  -0.7071067811865471,  -4.286263797015736e-16,  0.7071067811865466,  1.0,  0.7071067811865472,  5.51091059616309e-16,  -0.7071067811865465,  -1.0,  -0.7071067811865474,  -2.4499125789312946e-15,  0.7071067811865464,  1.0,  0.7071067811865475,  -9.803364199544708e-16,  -0.7071067811865464,  -1.0,  -0.7071067811865476,  -2.6948419387607653e-15,  0.7071067811865462,  1.0,  0.7071067811865476,  -7.354070601250002e-16,  -0.7071067811865461,  -1.0,  -0.7071067811865477,  -2.939771298590236e-15,  0.707106781186546,  1.0,  0.7071067811865503,  -4.904777002955296e-16,  -0.707106781186546,  -1.0,  -0.7071067811865479,  -3.1847006584197066e-15,  0.7071067811865483,  1.0,  0.7071067811865505,  -2.45548340466059e-16,  -0.7071067811865458,  -1.0,  -0.707106781186548,  -3.4296300182491773e-15,  0.7071067811865482,  1.0,  0.7071067811865507,  -6.189806365883577e-19,  -0.7071067811865456,  -1.0,  -0.7071067811865482,  -3.674559378078648e-15,  0.707106781186548},
        {  1.0,  -0.09801714032956065,  -0.9807852804032304,  0.29028467725446294,  0.9238795325112867,  -0.4713967368259975,  -0.8314696123025446,  0.634393284163646,  0.7071067811865472,  -0.773010453362737,  -0.5555702330196026,  0.8819212643483555,  0.3826834323650876,  -0.9569403357322089,  -0.19509032201612678,  0.9951847266721968,  -7.354070601250002e-16,  -0.9951847266721967,  0.19509032201612822,  0.9569403357322085,  -0.382683432365089,  -0.8819212643483532,  0.5555702330196038,  0.7730104533627371,  -0.7071067811865508,  -0.6343932841636436,  0.8314696123025455,  0.4713967368259993,  -0.923879532511288,  -0.2902846772544615,  0.9807852804032302,  0.09801714032955697,  -1.0,  0.0980171403295599,  0.9807852804032297,  -0.29028467725446433,  -0.9238795325112868,  0.4713967368260019,  0.8314696123025438,  -0.6343932841636514,  -0.7071067811865487,  0.773010453362739,  0.5555702330195954,  -0.8819212643483545,  -0.3826834323650863,  0.9569403357322114,  0.1950903220161288,  -0.9951847266721973,  9.311648537976002e-15,  0.9951847266721969,  -0.19509032201613313,  -0.9569403357322102,  0.38268343236509034,  0.8819212643483524,  -0.5555702330195991,  -0.7730104533627362,  0.7071067811865519,  0.6343932841636479,  -0.8314696123025462,  -0.47139673682599176,  0.9238795325112857,  0.2902846772544601,  -0.9807852804032319,  -0.09801714032956259},
        {  1.0,  6.123233995736766e-17,  -1.0,  -1.8369701987210297e-16,  1.0,  3.061616997868383e-16,  -1.0,  -4.286263797015736e-16,  1.0,  5.51091059616309e-16,  -1.0,  -2.4499125789312946e-15,  1.0,  -9.803364199544708e-16,  -1.0,  -2.6948419387607653e-15,  1.0,  -7.354070601250002e-16,  -1.0,  -2.939771298590236e-15,  1.0,  -4.904777002955296e-16,  -1.0,  -3.1847006584197066e-15,  1.0,  -2.45548340466059e-16,  -1.0,  -3.4296300182491773e-15,  1.0,  -6.189806365883577e-19,  -1.0,  -3.674559378078648e-15,  1.0,  2.443103791928823e-16,  -1.0,  -3.919488737908119e-15,  1.0,  4.892397390223529e-16,  -1.0,  -4.164418097737589e-15,  1.0,  7.839596456452825e-15,  -1.0,  -4.40934745756706e-15,  1.0,  9.790984586812941e-16,  -1.0,  2.4511505402044715e-15,  1.0,  8.329455176111767e-15,  -1.0,  -4.899206177226001e-15,  1.0,  1.4689571783402355e-15,  -1.0,  1.96129182054553e-15,  1.0,  8.819313895770708e-15,  -1.0,  -5.389064896884942e-15,  1.0,  1.9588158979991767e-15,  -1.0,  1.471433100886589e-15},
        {  1.0,  0.9951847266721969,  0.9807852804032304,  0.9569403357322088,  0.9238795325112867,  0.881921264348355,  0.8314696123025452,  0.773010453362737,  0.7071067811865476,  0.6343932841636455,  0.5555702330196023,  0.4713967368259978,  0.38268343236508984,  0.29028467725446233,  0.19509032201612833,  0.09801714032956077,  6.123233995736766e-17,  -0.09801714032956065,  -0.1950903220161282,  -0.29028467725446216,  -0.3826834323650897,  -0.4713967368259977,  -0.555570233019602,  -0.6343932841636454,  -0.7071067811865475,  -0.773010453362737,  -0.8314696123025453,  -0.8819212643483549,  -0.9238795325112867,  -0.9569403357322088,  -0.9807852804032304,  -0.9951847266721968,  -1.0,  -0.9951847266721969,  -0.9807852804032304,  -0.9569403357322089,  -0.9238795325112868,  -0.881921264348355,  -0.8314696123025455,  -0.7730104533627371,  -0.7071067811865477,  -0.6343932841636459,  -0.5555702330196022,  -0.47139673682599786,  -0.38268343236509034,  -0.29028467725446244,  -0.19509032201612866,  -0.09801714032956045,  -1.8369701987210297e-16,  0.09801714032956009,  0.1950903220161283,  0.29028467725446205,  0.38268343236509,  0.4713967368259976,  0.5555702330196018,  0.6343932841636456,  0.7071067811865474,  0.7730104533627367,  0.8314696123025452,  0.8819212643483548,  0.9238795325112865,  0.9569403357322088,  0.9807852804032303,  0.9951847266721969},
        {  1.0,  0.6343932841636455,  -0.1950903220161282,  -0.8819212643483549,  -0.9238795325112868,  -0.29028467725446244,  0.5555702330196018,  0.9951847266721969,  0.7071067811865477,  -0.09801714032955997,  -0.8314696123025451,  -0.9569403357322087,  -0.38268343236509056,  0.47139673682599736,  0.9807852804032304,  0.7730104533627377,  5.51091059616309e-16,  -0.773010453362737,  -0.9807852804032307,  -0.4713967368259983,  0.38268343236508956,  0.9569403357322089,  0.8314696123025448,  0.09801714032956282,  -0.7071067811865464,  -0.995184726672197,  -0.5555702330196027,  0.2902846772544622,  0.9238795325112868,  0.8819212643483563,  0.19509032201613036,  -0.6343932841636443,  -1.0,  -0.6343932841636459,  0.19509032201612822,  0.8819212643483553,  0.9238795325112877,  0.29028467725446433,  -0.555570233019601,  -0.9951847266721968,  -0.7071067811865479,  0.09801714032956063,  0.8314696123025456,  0.9569403357322086,  0.3826834323650883,  -0.47139673682599326,  -0.9807852804032295,  -0.7730104533627394,  -3.4296300182491773e-15,  0.7730104533627351,  0.9807852804032309,  0.4713967368259993,  -0.3826834323650885,  -0.9569403357322086,  -0.8314696123025455,  -0.09801714032956038,  0.707106781186548,  0.9951847266721968,  0.5555702330196066,  -0.2902846772544578,  -0.9238795325112851,  -0.8819212643483568,  -0.19509032201613144,  0.6343932841636434},
        {  1.0,  0.9807852804032304,  0.9238795325112867,  0.8314696123025452,  0.7071067811865476,  0.5555702330196023,  0.38268343236508984,  0.19509032201612833,  6.123233995736766e-17,  -0.1950903220161282,  -0.3826834323650897,  -0.555570233019602,  -0.7071067811865475,  -0.8314696123025453,  -0.9238795325112867,  -0.9807852804032304,  -1.0,  -0.9807852804032304,  -0.9238795325112868,  -0.8314696123025455,  -0.7071067811865477,  -0.5555702330196022,  -0.38268343236509034,  -0.19509032201612866,  -1.8369701987210297e-16,  0.1950903220161283,  0.38268343236509,  0.5555702330196018,  0.7071067811865474,  0.8314696123025452,  0.9238795325112865,  0.9807852804032303,  1.0,  0.9807852804032304,  0.9238795325112867,  0.8314696123025455,  0.7071067811865477,  0.5555702330196023,  0.38268343236509045,  0.19509032201612878,  3.061616997868383e-16,  -0.1950903220161273,  -0.3826834323650899,  -0.5555702330196017,  -0.7071067811865467,  -0.8314696123025451,  -0.9238795325112864,  -0.9807852804032305,  -1.0,  -0.9807852804032307,  -0.9238795325112867,  -0.8314696123025456,  -0.7071067811865471,  -0.5555702330196024,  -0.38268343236509056,  -0.19509032201612803,  -4.286263797015736e-16,  0.1950903220161272,  0.3826834323650898,  0.5555702330196016,  0.7071067811865466,  0.8314696123025451,  0.9238795325112864,  0.9807852804032304},
        {  1.0,  0.773010453362737,  0.19509032201612833,  -0.4713967368259977,  -0.9238795325112867,  -0.9569403357322089,  -0.5555702330196022,  0.09801714032956009,  0.7071067811865474,  0.9951847266721969,  0.8314696123025455,  0.29028467725446255,  -0.3826834323650899,  -0.8819212643483548,  -0.9807852804032307,  -0.6343932841636454,  -4.286263797015736e-16,  0.6343932841636447,  0.9807852804032304,  0.8819212643483553,  0.38268343236509067,  -0.29028467725446255,  -0.831469612302545,  -0.9951847266721969,  -0.7071067811865474,  -0.0980171403295627,  0.5555702330196015,  0.9569403357322089,  0.9238795325112875,  0.4713967368259984,  -0.19509032201612858,  -0.7730104533627357,  -1.0,  -0.7730104533627368,  -0.19509032201613025,  0.4713967368259969,  0.9238795325112868,  0.9569403357322095,  0.5555702330196028,  -0.09801714032956099,  -0.7071067811865461,  -0.9951847266721968,  -0.831469612302545,  -0.2902846772544642,  0.3826834323650891,  0.8819212643483553,  0.9807852804032309,  0.634393284163646,  -4.904777002955296e-16,  -0.6343932841636468,  -0.9807852804032297,  -0.8819212643483565,  -0.38268343236509145,  0.2902846772544618,  0.8314696123025456,  0.9951847266721967,  0.7071067811865505,  0.09801714032956356,  -0.5555702330196007,  -0.9569403357322087,  -0.9238795325112865,  -0.47139673682599603,  0.19509032201612425,  0.7730104533627351},
        {  1.0,  0.09801714032956077,  -0.9807852804032304,  -0.2902846772544633,  0.9238795325112865,  0.471396736825998,  -0.8314696123025442,  -0.6343932841636467,  0.7071067811865466,  0.7730104533627377,  -0.5555702330196015,  -0.8819212643483562,  0.3826834323650863,  0.9569403357322094,  -0.19509032201612508,  -0.995184726672197,  -2.6948419387607653e-15,  0.9951847266721965,  0.19509032201613036,  -0.9569403357322078,  -0.3826834323650912,  0.8819212643483536,  0.5555702330196061,  -0.7730104533627331,  -0.7071067811865529,  0.6343932841636439,  0.8314696123025471,  -0.47139673682599326,  -0.9238795325112893,  0.2902846772544547,  0.9807852804032309,  -0.09801714032955673,  -1.0,  -0.09801714032956746,  0.9807852804032288,  0.29028467725446505,  -0.9238795325112851,  -0.47139673682600275,  0.8314696123025412,  0.6343932841636523,  -0.7071067811865452,  -0.7730104533627399,  0.5555702330195971,  0.8819212643483586,  -0.3826834323650813,  -0.9569403357322119,  0.1950903220161163,  0.9951847266721983,  1.5189953173883297e-14,  -0.9951847266721966,  -0.19509032201613216,  0.9569403357322073,  0.3826834323650962,  -0.881921264348351,  -0.5555702330196105,  0.7730104533627297,  0.7071067811865567,  -0.6343932841636343,  -0.8314696123025541,  0.47139673682599476,  0.9238795325112886,  -0.29028467725445634,  -0.980785280403232,  0.09801714032955137},
        {  1.0,  0.8314696123025452,  0.38268343236508984,  -0.1950903220161282,  -0.7071067811865475,  -0.9807852804032304,  -0.9238795325112868,  -0.5555702330196022,  -1.8369701987210297e-16,  0.5555702330196018,  0.9238795325112865,  0.9807852804032304,  0.7071067811865477,  0.19509032201612878,  -0.3826834323650899,  -0.8314696123025451,  -1.0,  -0.8314696123025456,  -0.38268343236509056,  0.1950903220161272,  0.7071067811865466,  0.9807852804032304,  0.9238795325112867,  0.5555702330196025,  5.51091059616309e-16,  -0.5555702330196015,  -0.9238795325112864,  -0.9807852804032307,  -0.7071067811865474,  -0.19509032201613,  0.38268343236508956,  0.831469612302544,  1.0,  0.8314696123025448,  0.3826834323650909,  -0.19509032201612858,  -0.7071067811865464,  -0.9807852804032304,  -0.9238795325112876,  -0.5555702330196027,  -2.6948419387607653e-15,  0.5555702330196013,  0.9238795325112868,  0.9807852804032308,  0.7071067811865476,  0.19509032201613036,  -0.3826834323650892,  -0.8314696123025438,  -1.0,  -0.831469612302545,  -0.3826834323650912,  0.19509032201612822,  0.707106781186546,  0.9807852804032303,  0.9238795325112877,  0.5555702330196061,  -4.904777002955296e-16,  -0.555570233019601,  -0.9238795325112854,  -0.9807852804032301,  -0.7071067811865479,  -0.19509032201613072,  0.38268343236508556,  0.8314696123025456}};
    const bool sinLUT[10][64] = {
        {  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false},
        {  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false},
        {  false,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false},
        {  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  false,  false,  false,  true,  true,  false,  false,  true,  false,  false,  false,  true,  true,  false,  false,  true,  false,  false,  false,  true,  true,  false,  false,  true,  false,  false,  true,  true,  true,  false,  false,  true,  false,  false,  false,  true,  true,  false},
        {  false,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false},
        {  false,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false},
        {  false,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false,  false},
        {  false,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false},
        {  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false,  true,  true,  false,  false},
        {  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false,  true,  true,  true,  true,  true,  false,  false,  false,  false,  false}};

    for (int i = 0; i < 10; i++) {
        const int k = topFrequencies[i];
        const float harmonic = 0.09817477042468103 * k;
        float re = 0;
        float im = 0;
        // optimized case
        if (k == 0) {
            for (int n = 0; n < 64; n++) {
                re += features[n];
            }
        }

        else {
            for (int n = 0; n < 64; n++) {
                const float cos_n = cosLUT[i][n];
                const float sin_n = sinLUT[i][n] ? sqrt(1 - cos_n * cos_n) : -sqrt(1 - cos_n * cos_n);
                re += features[n] * cos_n;
                im -= features[n] * sin_n;
            }
        }

        fft[i] = sqrt(re * re + im * im);
    }
}
